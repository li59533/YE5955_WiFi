# 无线温振传感器\_通讯协议
**V0.0.3**

## 1.协议说明
**协议版本**：
协议类别：联能传感器私有协议

协议版本：V1.0.0

数据模式：小端模式

### 1.1 协议格式
```
typedef struct
{
	uint8_t head; //固定头标识
	uint8_t type; //报文类别
	uint16_t len; //payload长度
	uint8_t *payload; //
	uint8_t sum;  //校验和， 从type到payload结束
	uint8_t foot; //固定尾标识
}
```

## 2.协议内容
### 2.1 TYPE说明
|序号|TYPE|属性|说明|
|---|---|---|---|
||0x01|开始采集|在正常功耗下触发采集，并开始发送数据|
||0x00|停止采集|在正常功耗下停止采集。|
||0x74|特性值上报||
||0x70|波形上报||
||0x02|SN码上报||
||0x02|SN码请求||
||0x03|通道ID请求||
||0x03|通道ID上报||
||0x04|本地IP信息请求||
||0x04|本地IP信息上报||
||0x11|灯塔标识|类似心跳|
||0x12|启动灯塔标识（暂无作用）||
||0x13|设置工厂参数请求（暂无作用）||
||0x05|设置本地IP信息请求||
||0x0B|设置工作模式（暂无作用）|特征值模式、波形模式、报警模式|
||0x30|请求单次波形（暂无作用）||
||0x0a|设置通道字请求||
||0x57|通道字查询请求||
||0x57|通道字上报||
||0x06|采样参数请求||
||0x06|采样参数上报||
||0x07|设置采样参数请求||
||0x51|设置AP信息请求||
||0x52|设置ServerIP信息请求||
||0x54|ServerIP信息查询请求||
||0x54|ServerIP信息上报||
||0x50|设置本地时间请求||
||0x53|AP信息查询请求||
||0x53|AP信息上报||
||0x55|应用网络参数请求（暂无作用，只会触发保存）||
||0x40|(暂无作用)||
||0x15|设置报警源请求（暂无作用）||
||0x16|报警源查询请求（暂无作用）||
||0x16|报警源上报（暂无作用）||
||0x17|设置低功耗参数请求||
||0x19|低功耗参数查询请求||
||0x19|低功耗参数上报||
||0x75|设置附加配置_1请求|配置报警下的唤醒间隔，温度补偿值|
||0x76|附加配置_1查询请求||
||0x76|附加配置_1上报||
||0x56|工作模式查询请求（暂无作用）||
||0x56|工作模式上报||
||0x69|(暂无作用)||
||0x68|ADC校准（暂无作用）||
||0x09|设置计算参数请求||
||0x08|计算参数查询请求||
||0x08|计算参数上报||
||0x88|设置SN码请求||
||0x83|IAP升级报文擦出请求|该报文包含IAP升级数据长度|
||0x80|版本号查询请求||
||0x82|IAP升级数据包请求|该报文包含IAP升级数据|
||0x84|重启请求||
||0x18|交互结束请求|低功耗下会触发休眠|
||0x72|设置报警阈值请求|君悦专用|
||0x73|报警阈值查询请求|君悦专用|
||0x73|报警阈值上报|君悦专用|
||0x98|设置电量请求||

### 2.2 详细说明
#### 2.2.1 开始采集（0x01）
_开始采集，正常功耗下开始上报数据_

**类型：**请求，由服务器下发

**payload：**无

**返回：**返回相同报文

**例**：

发送：
	
```
	0x7e 0x01 0x00 0x00 0x01 0x7e
```
返回：
	
```
	0x7e 0x01 0x00 0x00 0x01 0x7e
```

#### 2.2.2 开始采集（0x00）
_停止采集，正常功耗下停止采集，并停止上报_

**类型：**请求，由服务器下发

**payload：**无

**返回：**返回相同报文

**例**：

发送：
	
```
	0x7e 0x00 0x00 0x00 0x00 0x7e
```

返回：
	
```
	0x7e 0x00 0x00 0x00 0x00 0x7e
```

#### 2.2.3 特性值上报（0x74）
_特性值上报_

**类型：**上报

**payload：**
	
```
{
    uint8_t year_L;
    uint8_t year_H;
    uint8_t Mon;
    uint8_t Day;
    uint8_t Hour;
    uint8_t Min;
    uint8_t Sec;
    float Z_EffectiveValue; //Z轴加速度有效值
    uint8_t Alarm_1;
    float Z_Vrms; // Z轴速度有效值
    uint8_t Alarm_2;
    float Z_Drms; // Z轴位移有效值
    uint8_t Alarm_3;
    float Z_Kur; //Z轴峭度
    uint8_t Alarm_4;
    flaot Z_Env; //Z轴包络
    uint8_t Alarm_5;
    float X_EffectiveValue; //X轴加速度有效值
    uint8_t Alarm_6;
    float X_Vrms; // X轴速度有效值
    uint8_t Alarm_7;
    float X_Drms; // X轴位移有效值
    uint8_t Alarm_8;
    float X_Kur; //X轴峭度
    uint8_t Alarm_9;
    flaot X_Env; //X轴包络
    uint8_t Alarm_10;

    float Y_EffectiveValue; //Y轴加速度有效值
    uint8_t Alarm_11;
    float Y_Vrms; // Y轴速度有效值
    uint8_t Alarm_12;
    float Y_Drms; // Y轴位移有效值
    uint8_t Alarm_13;
    float Y_Kur; //Y轴峭度
    uint8_t Alarm_14;
    flaot Y_Env; //Y轴包络
    uint8_t Alarm_15;

    float temperature; // 温度
    uint8_t Alarm_16;
    float battery; // 电量
    uint8_t Alarm_17;

}payload
```
**返回：**返回相同报文

**例：**

上报：
	
```
	(待补充)
```


#### 2.2.4 波形上报（0x70）
_波形上报_

**类型：**上报

**payload：**

```
{
    uint8_t channel ; // 通道号
    uint8_t year_L;
    uint8_t year_H;
    uint8_t Mon;
    uint8_t Day;
    uint8_t Hour;
    uint8_t Min;
    uint8_t Sec;	
    uint16_t package_No; // 包号
    uint16_t wareValue[256]; // 波形 ，实际值 = 波形 * 量程 * 灵敏度 / 1500;
    
}
```

**返回：**无

**说明：**

1.波形数据是分包上报的，上位机需根据通道号和包号进行组包。每包包含的256包，16384即**64**包
	
2.Channel：1->Z轴 ， 2->X轴 ， 3->Y轴

**例**：

上报：
	
```
	待补充
```


​	
#### 2.2.5 SN码上报（0x02）
_SN码上报_

**类型：**上报

**payload：**

```
{
	uint8_t SNcode[8]; // 8字节SN码 
    
}
```
**返回：**无

**说明：**

无

**例**：

上报：
	
```
    待补充
```

#### 2.2.6 SN码请求（0x02）
_SN码请求_

**类型：**请求

**payload：**

无
**返回：** 返回2.2.5报文内容

**说明：**

无

**例**：
请求：
```
    待补充
```
返回：
```
    待补充
```

#### 2.2.7 通道ID请求（0x03）
_通道ID请求_

**类型：**请求

**payload：**

无
**返回：** 返回2.2.8报文内容

**说明：**

无

**例**：
请求：
```
    待补充
```
返回：
```
    待补充
```

#### 2.2.8 通道ID上报（0x03）
_通道ID上报_

**类型：**上报

**payload：**
```
{
	uint8_t channelCount  ; //  通道总数
	uint8_t channeltypeCount ; // 通道类别总数
	uint8_t firsttype_flag  ; // 通道标识
	uint8_t firsttype_count ; // 这种通道的数量
	uint8_t secondtype_type  ; // 通道标识
	uint8_t secondtype_count ; // 这种通道的数量
	...
    
}
```
**返回：** 无

**说明：**

无

**例**：
上报：
```
    待补充
```

#### 2.2.9 本地IP信息请求（0x04）
_本地IP信息请求_

**类型：**请求

**payload：**
无
**返回：** 2.2.10报文内容

**说明：**

无

**例**：
请求：
```
    待补充
```
返回：
```
    待补充
```

#### 2.2.10  本地IP信息上报（0x04）
_本地IP信息上报_

**类型：**上报

**payload：**
```
{
	uint8_t 0x00 ; // IP标识
	uint8_t len ; // IP长度（字符串长度）
	uint8_t * IP_str;
	uint8_t 0x01 ; // 子网掩码标识
	uint8_t len ; // 子网掩码长度（字符串长度）
	uint8_t * Mask_str;	
	uint8_t 0x02 ; // 网关标识
	uint8_t len ; //  网关长度（字符串长度）
	uint8_t * Getway_str;
	uint8_t 0x03 ; // DHCP标识
	uint8_t 0x01 ; //  DHCP长度（字符串长度）
	uint8_t DHCP_Flag;
}
```
**返回：** 
无
**说明：**

无

**例**：
上报：
```
    待补充
```
#### 2.2.11 心跳（0x11）
_心跳请求_

**类型：**请求

**payload：**
无
**返回：** 
返回相同报文。
**说明：**

无

**例**：
请求：
```
    待补充
```
返回：
```
    待补充
```
#### 2.2.12 设置本地IP信息请求（0x05）
_设置本地IP信息请求_

**类型：**请求

**payload：**

```
{
	uint8_t 0x00 ; // IP标识
	uint8_t len ; // IP长度（字符串长度）
	uint8_t * IP_str;
	uint8_t 0x01 ; // 子网掩码标识
	uint8_t len ; // 子网掩码长度（字符串长度）
	uint8_t * Mask_str;	
	uint8_t 0x02 ; // 网关标识
	uint8_t len ; //  网关长度（字符串长度）
	uint8_t * Getway_str;
	uint8_t 0x03 ; // DHCP标识
	uint8_t 0x01 ; //  DHCP长度（字符串长度）
	uint8_t DHCP_Flag;
}

```
**返回：** 
返回相同报文，但type替换为0xe4。
**说明：**
无
**例**：
请求：

```
    待补充
```
返回：
```
    待补充
```

#### 2.2.13 设置工作模式请求（0x0B）
_设置工作模式请求_  **暂无作用**

**类型：**请求

**payload：**
```
{
	uint8_t RUN_Mode ; // 
}

```
**返回：** 
返回相同报文。
**说明：**
无
**例**：
请求：

```
    待补充
```
返回：
```
    待补充
```

#### 2.2.14 设置AP信息请求（0x51）
_设置AP信息请求_  **暂无作用**

**类型：**请求

**payload：**
```
{
	uint8_t APssid_Flag ; // ssid 标识 
	uint8_t APssid_len ; // ssid 字符串长度
	uint8_t *APssid_str ; // ssid 字符串
	uint8_t APpassword_Flag ; // password 标识
	uint8_t APpassword_len ;  // password 字符串长度
	uint8_t APpassword_str ; // password 字符串
}

```
**返回：** 
返回相同报文。
**说明：**
无
**例**：
请求：

```
    待补充
```
返回：
```
    待补充
```

#### 2.2.15 设置通道字请求（0x0a）
_设置通道字请求_  

**类型：**请求

**payload：**
```
{
	uint16_t Channels_Enable ; // 通道是否传输数据
}

```
**返回：** 
返回相同报文。
**说明：**
无
**例**：
请求：

```
    待补充
```
返回：
```
    待补充
```
#### 2.2.16 通道字查询请求（0x57）
_通道字查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.17报文
**说明：**
无
**例**：
请求：

```
    待补充
```
返回：
```
    待补充
```

#### 2.2.17 通道字查询上报（0x57）
_通道字查询上报_  

**类型：**上报

**payload：**
```
{
	uint16_t Channels_Enable ;  // 通道字
}
```
**返回：** 
无
**说明：**
无
**例**：
请求：

```
    待补充
```
返回：
```
    待补充
```

#### 2.2.18 采样参数查询请求（0x06）
_采样参数查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.19报文
**说明：**
无
**例**：
请求：

```
    待补充
```
返回：
```
    待补充
```

#### 2.2.19 采样参数查询上报（0x06）
_采样参数查询上报_  

**类型：**上报

**payload：**
```
{
	uint32_t ADFrequence  ; // AD采样率
	uint8_t ADSample_Time ; // 采样时间
	uint16_t PeriodTransimissonCounter ; // 自动发送波形间隔
	uint8_t PeriodTransimissonCounter_Status ; // 自动发送波形状态
	uint16_ WorkcycleSecond ; //休眠时间（工作循环）
	uint8_t ParamTransimisson_Status ; // 特征值发送状态。
}
```
**返回：** 
无
**说明：**
无
**例**：
上报：
```
    待补充
```
#### 2.2.20 设置采样参数请求（0x07）
_设置采样参数请求_  

**类型：**请求

**payload：**
```
{
	uint32_t ADFrequence  ; // AD采样率
	uint8_t ADSample_Time ; // 采样时间
	uint16_t PeriodTransimissonCounter ; // 自动发送波形间隔
	uint8_t PeriodTransimissonCounter_Status ; // 自动发送波形状态
	uint16_ WorkcycleSecond ; //休眠时间（工作循环）
	uint8_t ParamTransimisson_Status ; // 特征值发送状态。
}
```
**返回：** 
返回相同报文
**说明：**
无
**例**：
上报：
```
    待补充
```
#### 2.2.21 设置ServerIP信息请求（0x52）
_设置ServerIP信息请求_  

**类型：**请求

**payload：**
```
{
	uint8_t TCPServerIP_Flag ;  // ServerIP 标识
	uint8_t len ; // ServerIP 字符串长度
	uint8_t * TCPServerIP_Str ; // ServerIP 字符串
	uint8_t TCPServerPort_Flag ; // ServerIP_Port_Flag  标识
	uint8_t len ; // ServerPort 字符串长度
	uint8_t * TCPServerPort_Str ; // ServerPort 字符串长度
}
```
**返回：** 
返回相同报文，type更换为0xe7
**说明：**
无
**例**：
```
    待补充
```
#### 2.2.22 ServerIP信息查询请求（0x54）
_ServerIP信息查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.23报文
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.23 ServerIP信息上报（0x54）
_ServerIP信息上报_  

**类型：**上报

**payload：**
```
{
	uint8_t TCPServerIP_Flag ;  // ServerIP 标识 **0x01**
	uint8_t len ; // ServerIP 字符串长度
	uint8_t * TCPServerIP_Str ; // ServerIP 字符串
	uint8_t TCPServerPort_Flag ; // ServerIP_Port_Flag  标识**0x01**
	uint8_t len ; // ServerPort 字符串长度
	uint8_t * TCPServerPort_Str ; // ServerPort 字符串长度
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.24 设置本地时间请求（0x50）
_设置本地时间请求_  

**类型：**请求

**payload：**
```
{
	uint16_t Year ; // 年
	uint8_t Mon ; // 月
	uint8_t Day ; // 日
	uint8_t hour ; // 时
	uint8_t min ; // 分
	uint8_t sec ; // 秒
}
```
**返回：** 
返回相同报文。
**说明：**
无
**例**：

```
    待补充
```


#### 2.2.25 AP信息查询请求（0x53）
_AP信息查询请求请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.26报文。
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.26 AP信息上报（0x53）
_AP信息上报_  

**类型：**上报

**payload：**
```
{
	uint8_t APssid_Flag ; // ssid 标识 **0x00**
	uint8_t APssid_len ; // ssid 字符串长度
	uint8_t *APssid_str ; // ssid 字符串
	uint8_t APpassword_Flag ; // password 标识  **0x01**
	uint8_t APpassword_len ;  // password 字符串长度
	uint8_t APpassword_str ; // password 字符串
}

```
**返回：** 
无。
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.27 设置低功耗参数请求（0x17）
_ 设置低功耗参数请求_  

**类型：**请求

**payload：**
```
{
	uint8_t LowPower_Enable  ;//  0 :正常功耗 ， 1:低功耗
  uint8_t Scan_Channel ;  // 暂时无用
  uint8_t WorkTime_Sec ; // 唤醒后工作限制时间
  uint8_t IEPEWaitTime ;  // IEPE稳定时间
}
```
**返回：** 
返回相同报文。
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.28  低功耗参数查询请求（0x19）
_ 低功耗参数查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.29报文。
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.29  低功耗参数上报（0x19）
_ 低功耗参数上报_  

**类型：**上报

**payload：**
```
{
	uint8_t LowPower_Enable  ;//  0 :正常功耗 ， 1:低功耗
  uint8_t Scan_Channel ;  // 暂时无用
  uint8_t WorkTime_Sec ; // 唤醒后工作限制时间
  uint8_t IEPEWaitTime ;  // IEPE稳定时间
  uint16_t 备用;
  uint16_t 备用;
  
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.30  设置附加配置_1请求（0x75）
_ 设置附加配置_1请求_  

**类型：**请求

**payload：**
```
{
	uint16_t WorkCycle_InAlarm ; // 报警下的工作间隔
	int16_t Temperature_Comp; // 温度补偿值，5->0.5;
  
}
```
**返回：** 
相同报文
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.31  附加配置_1查询请求（0x76）
_ 附加配置_1查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.32报文。
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.32  附加配置_1上报（0x76）
_ 附加配置_1上报_  

**类型：**上报

**payload：**
```
{
	uint16_t WorkCycle_InAlarm ; // 报警下的工作间隔
	int16_t Temperature_Comp; // 温度补偿值，5->0.5;
  uint16_t 备用;
	uint16_t 备用;
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.33  工作模式查询请求（0x56）
_ 工作模式查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.34 报文
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.34  工作模式上报（0x56）
_ 工作模式上报(暂时无用)_  

**类型：**上报

**payload：**
```
{
	uint8_t Run_Mode ; 
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.35  设置计算参数请求（0x09）
_ 设置计算参数请求_  

**类型：**请求

**payload：**
```
{
	uint8_t Channel_Num_1 ; // 通道号
  uint32_t Channel_Freq_1 ; // 通道采样频率
  float Scale_1;
  float AlarmGate_1 ;
  float Range_1 ; 
  uint8_t Channel_Num_2 ; // 通道号
  uint32_t Channel_Freq_2 ; // 通道采样频率
  float Scale_2;
  float AlarmGate_2 ;
  float Range_2 ; 
  uint8_t Channel_Num_3 ; // 通道号
  uint32_t Channel_Freq_3 ; // 通道采样频率
  float Scale_3;
  float AlarmGate_3 ;
  float Range_3 ; 
}
```
**返回：** 
返回相同报文。
**说明：**
无
**例**：

```
    待补充
```


#### 2.2.36  计算参数查询请求（0x08）
_ 计算参数查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.37报文。
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.37  计算参数上报（0x08）
_ 计算参数上报_  

**类型：**上报

**payload：**
```
{
	uint8_t Channel_Num_1 ; // 通道号
  uint32_t Channel_Freq_1 ; // 通道采样频率
  float Scale_1;
  float AlarmGate_1 ;
  float Range_1 ; 
  uint8_t Channel_Num_2 ; // 通道号
  uint32_t Channel_Freq_2 ; // 通道采样频率
  float Scale_2;
  float AlarmGate_2 ;
  float Range_2 ; 
  uint8_t Channel_Num_3 ; // 通道号
  uint32_t Channel_Freq_3 ; // 通道采样频率
  float Scale_3;
  float AlarmGate_3 ;
  float Range_3 ; 
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.38  设置SN码请求（0x88）
_ 设置SN码请求_  

**类型：**请求

**payload：**
```
{
	uint8_t SNnumber[8];
}
```
**返回：** 
返回相同报文。
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.39  IAP升级报文擦除请求（0x83）
_ IAP升级报文擦除请求_  

**类型：**请求

**payload：**
```
{
	uint8_t IAP_status ; // 0x01:ON , 0x03 :OFF
	uint32_t len ; // IAP 数据长度本包。

}
```
**返回：** 
返回2.2.40报文。
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.40  IAP升级报文擦除应答（0x83）
_ IAP升级报文擦除应答_  

**类型：**应答

**payload：**
```
{
	uin8_t Status ; // 0x02 :继续 ， 0x04:停止。
	uin8_t 备份;
	uin8_t 备份;
	uin8_t 备份;
	uin8_t 备份;
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.41  版本号查询请求（0x80）
_ 版本号查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.42 报文。
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.42  版本号上报（0x80）
_ 版本号上报_  

**类型：**上报

**payload：**
```
{
	uint8_t * Versin;
}
```
**返回：** 
无
**说明：**
Version 为字符串，长度<16
**例**：

```
    待补充
```

#### 2.2.43  IAP数据升级包请求（0x82）
_ IAP数据升级包请求_  

**类型：**请求

**payload：**
```
{
	uint8_t 备用;
	uint8_t 备用;
	uint8_t 备用;
	uint8_t Package_Count; // 包号
	uint8_t * data;
}
```
**返回：** 
返回2.2.44报文。
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.44  IAP数据升级包应答（0x82）
_ IAP数据升级包应答_  

**类型：**应答

**payload：**
```
{
	uint8_t Status  ; // 0x01: 继续 ， 0x00: stop 
	uint8_t 备用; 
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```


#### 2.2.45  重启软件（0x84）
_重启软件_  

**类型：**请求

**payload：**
无
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.46  交互结束请求（0x18）
_交互结束请求_  

**类型：**请求

**payload：**
无
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.47  设置报警阈值请求（0x72）
_设置报警值请求_  

**类型：**请求

**payload：**
```
{
	float Channel_1_Alarm ; 
	float Channel_2_Alarm ; 
	float Channel_3_Alarm ; 
}
```
**返回：** 
返回相同报文。
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.48  报警阈值查询请求（0x73）
_报警值查询请求_  

**类型：**请求

**payload：**
无
**返回：** 
返回2.2.48报文。
**说明：**
无
**例**：

```
    待补充
```
#### 2.2.49  报警阈值上报（0x73）
_报警值上报_  

**类型：**上报

**payload：**
```
{
	float Channel_1_Alarm ; 
	float Channel_2_Alarm ; 
	float Channel_3_Alarm ; 
}
```
**返回：** 
无
**说明：**
无
**例**：

```
    待补充
```

#### 2.2.50  设置电量请求（0x98）
_设置电量请求_  

**类型：**请求

**payload：**
```
{
	float battery; // 
}
```
**返回：** 
返回相同报文。
**说明：**
无
**例**：

```
    待补充
```